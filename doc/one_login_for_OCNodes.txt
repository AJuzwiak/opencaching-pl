
				Opencaching Network Implementation 
				    One Login for all Nodes
					Version 1.0 draft 2010
					    Waldek sp2ong

 
 Uwagi ogolne
 ------------
 
 Rozwazajac co jest glownym problemem uzywanie przez uzytkownikow innych wezlow OC to
 glownie problem jest w zrobienie wpisu do logu do skrzynki, ktora jest zarejstorwana na innym wezle OC.
 Zakladnie skrzynki nie powinno byc rozwazane i mozliwe gdyz po to sa lokalne OC Node, ktore dzialaja
 w nieduzym obszarze czy jednego kraju czy paru sasiednich skupiajac uzytkownikow majacych szanse 
 zapewnienia utrzymania skrzynki. Jeali przyjmiemy takie zalozenie wiec caly problem sprwadz sie do tego
jak zrobic wpis na innym OC Node do logu majac tylko jedno konto na swoim OC Node lokalnym.

Login
-----

Aby wprowadzic wpis do logu skrzynki nalezy byc zalogowanym do OC serwisu.
Jesli uzytkownik zalogowal sie do serwisu OC Node w postaci:

Loginname: username
Password: password

oznacza to ze uzytkownik jest lokalny tzn zrejstorwany na tym OC Node i sprawa jest prosta bo nie wymaga dzialania.

Jesli uzytkownik klikajac na ikone "Zrob wpis do logu" zostanie poproszony o to aby sie zalogowac i zrobi to w ten sposob:
Przyklad atrapy:

http://opencaching.pl/login_one.php

Login_name: rambo   -> wybor GC Node: opencaching.pl, ....
Passoword: pass   <-  Haslo tylko dostepne kiedy username loguje sie na swoim Node w pozostalych przypadkach pole Password nie jest
			dostepne gdyz haslo poda poprzekierowaniu na swoj gc servis do zalogowania i potwierdzania autentycznosci



Teraz natepuje proces autoryzacji 

.........   i tu jest najwiekszy problem jak to zrobic aby bylo bezpiecznie 

Czyli generalnie potrzeba nam to co zrobi FB ze mozna kontem na FB logowac sie an inne serwisy jesli pozwalaja to
FB Cnnect. Wydaje sie ze OpenID wlasnie pozwolilby nam na to

Czy OpenID zalatwia sprawe ?? moze ale musimy miec tablice wiarygodnych OpenID Serwerow OC aby ktos kto ma np 
konto na dowolnym serwerze OpenID nie mogl zrobic logowania. Byc moze nalezaloby by wykorzystac OAuth gdzie
w tablicy sql "nodes" oprocz nazwy node i jego numeru zawieray API-Key unikalny itd to co wymaga OAuth i dzieki
temu username i password oraz to ze serwis na ktorym jest zarejestrowny obcy user nalezy do sieci "Geocaching Network"
w ktorej sa OC Nodes oraz inne portale geocachingowe ktore chce korzystac z podobnego mechanizmu np GC Australia
OC.com, GPSGames.org itd

Przyklad OpenID http://code.google.com/p/lightopenid/ wydaje sie ze mozna to wykorzystac
jest clinet i server (provider) bo oba elementy sa nam potrzebne na kazdym Node

Pewnie najlepszy rozwiazaniem byloby:

1. dodoanie mozliwsoci logowania sie do OC przy pomocy OpenID z juz istniejacych serwerow openid.net, openid.pl etc
2. jak do tego podejsc sugestie sa tu: http://www.plaxo.com/api/openid_recipe
3. Wdrozyc OpenID server na OC Node aby mozna bylo logowac sie swoim OpenID z wlasnego OpenID OC servera


Tu potrzebny jest bardzo dobry programista ktory pozwoli nam zrealizowa pomysl autoryzacji

.........

Ok autoryzacja zostala potwierdzona mozemy dokonac wpisu do logu zgodnie z formularzem na danym OC Node a wiec na OC PL np 
bedzie mozna zrobic oprocz rekomendacji takze wystawic ocene skrzynki jesli to bedzie robione na OC DE to nie bedzie pytania 
o ocene skrzynki 

Ok user zrobil wpis do skrzynki na nie swoim OC Node teraz jak to wykazac w listingu wpisow do logu:

Icona Data username Typ_logu
gdzie username:

Jesli lokalny user to tylko samo username jesli user z innego OC Node (lub innego autoryzowanego serwisu np GC Australia)
wtedy username wyglada np:

Icona Data rambo[PL] Typ_logu

w nawiasie kwadratowym 2 literowy skrot kraju OC Node z ktorego pochodzi zarejstrowany user np z GC Austaralia bedzie:
geospin[AU]
Ok skoro tak to jak wiadomo link w username musi prowadzic do profilu usera wiec lokalny bedzie mial url "viewprofile.php?userid=xx"
dla OC PL http://opencaching.pl/viewprofile.php?userid=zzz" dla GC AU odpowiedni link.

Tak zalogowany user do obcego serwisu geocachingowego moze tylko wykonac wpis w logbook jego edycje lub skasowac. Mozemy sprawdzic 
czy zalogowany user ma numer Node loklany czy obcy jesli obcy to nie ma prawa zalozyc skrzynki bo i po co.

OK co w bazie ? tak zalogowany user ktory chce zrobic wpis i robi to pierwszy raz pewnie nalezaloby go wpisac w baze  bo w tablicy cache_logs
mamy user_id usera robiacego wpis wiec nalezy go wpisac w tablicy "user" a wic nada mu user_id w kolumnie "node" stosowny numer wezla a co w 
kolumnie password ? NULL ... 
Ok musimy wiec jesli user loguje sie z obcego GC Node dolozyc go do tablicy 'user' z odpowiednim numer Node ale co zrobic kiedy
juz taki username jest w naszje bazie ???? czy na dzien dobry dawac mu nazwe username_XX gdzie XX nazwa kraju np rambo_DE ale 
czy jest to rozwiazanie ?

Czyli w prosty sposob mam to co nam utrudnia z korzystania z innych OC Nodes pozwala zachowac idywidualnosc OC Nodes w postaci 
typow skrzynek, atrybutow, regulaminow zakldania skrzynek itd. Nie potrzebujemy robic synchoronizacji baz danych


Wady brak statystyk z obcych node w profilu na lokalnym Node z wpisow z obcych OC Nodes.


